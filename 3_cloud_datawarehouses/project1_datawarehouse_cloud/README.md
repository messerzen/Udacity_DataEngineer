# Project - Data Warehouse using Amazon Redshift
______

# Dataset overview

The datasets used in this project reside in Amazon S3. The dataset is composed by two subdatasets:

- Song Dataset: is a subset of a real dataset from the http://millionsongdataset.com/. Each file is in JSON format and contains metadata about the songs and the artists of each song.

- Log Dataset: contains log files in JSON format generated by the [event simulator](https://github.com/Interana/eventsim).

# Database schema

The Data Warehouse modeled in this project consists of five tables:

- staging_events (Staging Table for Log Dataset): stores the raw data from the Log Datasets

- staging_songs (Staging Table for Songs Dataset): stores the raw data from de Log Dataset.

- songplays (Fact Table): contains all the registers of user activity, describing which songs have listened by the user.

- users (Dimension Table): contains the data that describe the users;

- songs(Dimension Table): contains the data that describes artists;

- artists (Dimension Table): contains the data about that describe the artist.

- time (Dimension Table): contains the data that describe the time of each activity, and allows to identify activity by different time attributes (hour, day, weekday, month, week)


# Implementation Instructions

Create a dwh.cfg file with the amazon AWS credentials.

Create an IAM Role that makes Redshift able to access S3 bucket (ReadOnly).

Create a RedShift Cluster.

Insert IAM Role and Redshift Params in the dwh.cfg file.


Run the file `create_tables.py` . This script delete all the existing tables mentioned above in amazon redshift and creates new ones.

Run the file `etl.py`. This script will implement all the ETL process. First, the data storaged in Amazon S3 will be loaded in the staging tables. Finally, the script transformes the data in the staging tables and stores in the dimension and fact tables in Amazon Redhsift Cluster..

## Query examples

`-- Query to select top active users
SELECT count(songplay_id) total_songplay, users.first_name, users.last_name as name, users.level
FROM songplays JOIN users ON users.user_id = songplays.user_id 
GROUP BY users.first_name, users.last_name, users.level
ORDER BY total_songplay DESC LIMIT(10);`

Query result:

| total_songplay | name                   | level    |
| -------------- | ---------------------- | -------- |
| 689            | Chloe Cuevas           | paid     |
| 665            | Tegan Levine           | paid     |
| 557            | Kate Harrell           | paid     |
| 463            | Lily Koch              | paid     |
| 397            | Aleena Kirby           | paid     |
| 346            | Jacqueline Lynch       | paid     |
| 321            | Layla Griffin          | paid     |
| 289            | Jacob Klein            | paid     |
| **270**        | **Mohammad Rodriguez** | **free** |
| 248            | Matthew Jones          | paid     |

There is one user in the top 10 uses a free plan.

`-- Query to select sessions by plan
SELECT count(songplay_id) total_songplay, users.level as plan
FROM songplays JOIN users ON users.user_id = songplays.user_id
GROUP BY plan
ORDER BY total_songplay DESC;`

2

| total_songplay | plan |
| -------------- | ---- |
| 5435           | paid |
| 1385           | free |

**The most active users have a paid subscription.**

# 